const fs = require('fs');
const blacklist = ['_sidebar.md', 'img', "CNAME","README.md",'dist']
function getContent(_path,_dir="/",tab){
    let md = ""
    let files = ((fs.readdirSync(_path)).filter(item=>(blacklist.indexOf(item)<0 && !/^\.+.*/.test(item)))).sort((a, b) => {return a - b})
    if (_dir) {md = tab+"* "+_dir+"\n";tab+="  "}
    for (const i in files) {
        let item = files[i]
        let fullpath =_path+"/"+item
            let title = getTitle(fullpath,item)
        if(fs.lstatSync(fullpath).isDirectory()){
            md += getContent(fullpath,item,tab)
        }else if (/.*\.md$/.test(item)){
            md += tab+"* ["+title+"]("+((_path.replace(__dirname,"")+"/"+item).replaceAll(' ','%20').replaceAll('?','%3F').replaceAll(')','%29').replaceAll('#','%23'))+")\n"
        }
    }
    return md
}
function getTitle(path,md) {
    let title = md.substr(0,md.length-3)
    if (md.toLowerCase()=="readme.md"){
        title =  "README"
    }else if (md.indexOf('.md')<1) {
        title = md
    }else {
        let data = fs.readFileSync(path, 'utf8').split("\n")
        for (const i in data) {if(/^(\s*#){1}\s+.*/.test(data[i])) return data[i].replace(/^(\s*#){1}\s+/,"")}
    }
    return title
}
const md = getContent(__dirname,"","")
fs.writeFile(__dirname+'/_sidebar.md', md, { encoding: 'utf8' }, err => {  });
console.log("\n目录:\n",md)